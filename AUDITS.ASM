;	.FILE	"AUDITS.ASM"
*----------------------------------------------------------------------------
*
*
*COPYRIGHT (C) 1994 BY  TV GAMES, INC.
*ALL RIGHTS RESERVED
*


	.include	C30.EQU
	.include	MACS.EQU
	.include	VUNIT.EQU
	.include	CMOS.EQU
	.include	SYSID.EQU
	.include	SYS.EQU
	.include	GLOBALS.EQU
	.include	TEXT.EQU

	.include	DIRQ.EQU
	.include	DIAG.EQU
	.include	ERROR.EQU



	.text
*----------------------------------------------------------------------------
*DISPLAYABLE AUDITS
*
*	.word	AUDIT_#,string
*
*
AUDENT	.MACRO	AUDITI,ATEXT
	.word	:AUDITI:,l?
	.sect	"THEDATA"
l?	.string	":ATEXT:",0
	.text
	.ENDM

AUDENT_SPACER	.MACRO
	.word	-3
	.ENDM

AUDENT_PAGE	.MACRO
	.word	-1
	.ENDM

AUD_ROUTINE	.set	5Ah
AUD_ROUTINEH	.set	5A0000h

AUDENTR	.MACRO	AUDITI,ATEXT,ROUTINE
	.word	AUD_ROUTINEH|:AUDITI:,:ROUTINE:,l?
	.sect	"THEDATA"
l?	.string	":ATEXT:",0
	.text
	.ENDM


*----------------------------------------------------------------------------
*
*
*RETURN
*	R0	VALUE
*
COMPUTE_FREEGAMES_PRCNT:
	READAUD	AUD_GAMES_CONTINUES
	LDI	R0,R1
	READAUD	AUD_GAMES_START
	ADDI	R0,R1
	LDIZ	R1,R0
	RETSZ

	READAUD	AUD_TOTAL_FREEGAMES
;	ADDI	R0,R1
	MPYI	100,R0

	CALL	DIV_I30
	RETS
*----------------------------------------------------------------------------



*----------------------------------------------------------------------------
*
*
*RETURN
*	R0	VALUE
*
COMPUTE_GAMETIME:
	READAUD	AUD_GAMES_CONTINUES
	LDI	R0,R1
	READAUD	AUD_GAMES_START
	ADDI	R0,R1
	READAUD	AUD_GAMEON_TIME

	CALL	DIV_I30
	RETS

	
AUDIT_LIST
	AUDENT	AUD_COIN1,"LEFT COIN"
	AUDENT	AUD_COIN2,"RIGHT COIN"
	AUDENT	AUD_COIN3,"THIRD COIN"
	AUDENT	AUD_COIN4,"FOURTH COIN"
	AUDENT	AUD_SERVICE_CREDITS,"SERVICE CREDITS"
	AUDENT_SPACER

	AUDENT	AUD_GAMES_START,"TOTAL STARTS"
	AUDENT	AUD_GAMES_CONTINUES,"TOTAL CONTINUES"
	AUDENT	AUD_H2HGAMES,"HEAD 2 HEAD GAMES"
	AUDENT	AUD_TOTAL_FREEGAMES,"FREE RACES"
	AUDENT	AUD_GAMES_EXPIRED,"EXPIRED RACES"
	AUDENTR	AUD_GAMEON_TIME,"FREE RACE PERCENTAGE",COMPUTE_FREEGAMES_PRCNT
	AUDENT_SPACER

;	AUDENT	ADJ_DIFFICULTY,"DIFFICULTY"
;	AUDENT	ADJ_FIRST_PLACE_PERCENT,"1ST PLACE AUTO PERCENT"
	AUDENT	AUD_POWERON_TIME,"POWER ON TIME SECS"
	AUDENT	AUD_GAMEON_TIME,"GAME TIME SECS"
	AUDENTR	AUD_GAMEON_TIME,"AVERAGE GAME TIME SECS",COMPUTE_GAMETIME

	AUDENT_PAGE
	;-------
	

	AUDENT	AUD_AUTOMATIC_TRANS_SELECTED,"AUTOMATIC SELECTED"
	AUDENT	AUD_MANUAL_TRANS_SELECTED,"MANUAL SELECTED"
	AUDENT_SPACER

	AUDENT	AUD_VETTE_SELECTED,"63 MUSCLE SELECTED"
	AUDENT	AUD_LABOMBA_SELECTED,"LABOMBA SELECTED"
	AUDENT	AUD_DEVASTATOR_SELECTED,"DEVASTATOR SELECTED"
	AUDENT	AUD_ITALIA_SELECTED,"ITALIA SELECTED"
	AUDENT_SPACER
	AUDENT	AUD_HID_JEEP_SELECTED,"JEEP SELECTED"
	AUDENT	AUD_HID_COPCAR_SELECTED,"COPCAR SELECTED"
	AUDENT_SPACER

	AUDENT	AUD_VIEW1_TIME,"VIEW1 TIME SECS"
	AUDENT	AUD_VIEW2_TIME,"VIEW2 TIME SECS"
	AUDENT	AUD_VIEW3_TIME,"VIEW3 TIME SECS"
	AUDENT_PAGE
	;-------

	AUDENT	AUD_LOG_COUNT,"EVENT"
	AUDENT	AUD_NUM_UNFINISHED,"U-GAMES"
	AUDENT	AUD_NUM_WATCHDOGS,"WATCHDOGS"
	AUDENT	AUD_SUCCESSFULL_BURNINS,"BURNIN LOOPS"
	AUDENT_SPACER

	AUDENT	ADJ_DIFFICULTY,"GAME DIFFICULTY"
;	AUDENT	ADJ_DIFF_LOCAL,"LOCAL DIFFICULTY"
;	AUDENT	ADJ_FIRST_PLACE_PERCENT,"1ST PLACE AUTOPERCENTAGE"
;	AUDENT	ADJ_RAMP_PERCENTAGE,"RAMP PERCENTAGE"
;	AUDENT	ADJ_RAMPGAMES,"AUTO RAMP GAMES"
;	AUDENT	ADJ_RAMP_COUNT,"RAMP COUNT"
	AUDENT_PAGE
	;-------

	AUDENT	AUD_FS_AZ,"SELECT ARIZONA"
	AUDENT	AUD_FS_US101,"SELECT US101"
	AUDENT	AUD_FS_LA,"SELECT LA"
	AUDENT	AUD_FS_IOWA,"SELECT IOWA"
	AUDENT	AUD_FS_DV,"SELECT DEATH VALLEY"
	AUDENT	AUD_FS_USA,"SELECT USA"
	AUDENT	AUD_FS_BH,"SELECT BEVHILLS"
	AUDENT	AUD_FS_APPL,"SELECT APPALACHIA"
	AUDENT	AUD_FS_RW,"SELECT REDWOOD"
	AUDENT	AUD_FS_RM,"SELECT RUSHMORE"
	AUDENT	AUD_FS_CH,"SELECT CHICAGO"
	AUDENT_SPACER

	AUDENT	AUD_FS_HID_SF,"SELECT SANFRAN"
	AUDENT	AUD_FS_HID_IN,"SELECT INDIANA"
	AUDENT	AUD_FS_HID_GG,"SELECT GGATE"
	AUDENT_PAGE
	;-------

	AUDENT	AUD_START_GGATE,"START GGATE"
	AUDENT	AUD_START_SF,"START SF"
	AUDENT	AUD_START_US101,"START US101"
	AUDENT	AUD_START_REDWOOD,"START REDWOOD"
	AUDENT	AUD_START_BEVHILLS,"START BEVHILLS"
	AUDENT	AUD_START_LA,"START LA"
	AUDENT	AUD_START_DV,"START DV"
	AUDENT	AUD_START_ARIZONA,"START ARIZONA"	
	AUDENT	AUD_START_GC,"START GC"		
	AUDENT	AUD_START_IOWA,"START IOWA"		
	AUDENT	AUD_START_CHICAGO,"START CHICAGO"	
	AUDENT	AUD_START_INDIANA,"START INDIANA"
	AUDENT	AUD_START_APPALACHIA,"START APPALACHIA"
	AUDENT	AUD_START_DC,"START DC"
	AUDENT_PAGE
	;-------

	AUDENT	AUD_WIN_GGATE,"GGATE WINS"
	AUDENT	AUD_WIN_SF,"SANFRAN WINS"
	AUDENT	AUD_WIN_US101,"US101 WINS"
	AUDENT	AUD_WIN_REDWOOD,"REDWOOD WINS"
	AUDENT	AUD_WIN_BEVHILLS,"BEVHILLS WINS"
	AUDENT	AUD_WIN_LA,"LA WINS"
	AUDENT	AUD_WIN_DV,"DEATHVALLEY WINS"
	AUDENT	AUD_WIN_ARIZONA,"ARIZONA WINS"
	AUDENT	AUD_WIN_GC,"GRAND CANYON WINS"
	AUDENT	AUD_WIN_IOWA,"IOWA WINS"
	AUDENT	AUD_WIN_CHICAGO,"CHICAGO WINS"
	AUDENT	AUD_WIN_INDIANA,"INDIANA WINS"
	AUDENT	AUD_WIN_APPALACHIA,"APPALACHIA WINS"
	AUDENT	AUD_WIN_DC,"DC WINS"

	AUDENT_PAGE
	;-------

	.word	-2	;end of list
*----------------------------------------------------------------------------



*----------------------------------------------------------------------------
*AUDITS DISPLAY
*
	.bss	OLDDIP,1
AUDIT_DISPLAY:
	CALL	SETUP_DIAG_SCREEN

	CLRI	AR4			;page index

	LDI	DEFAULT_COLOR,RC
	TEXTITT	"HIT VOLUME UP FOR NEXT PAGE",50,330

	LDI	@SOFT_AUDIT,R0
	BNZ	KKLL

	LDI	DEFAULT_COLOR,RC
	TEXTITT	"DIP SWITCH BANK 2 SELECTS COIN MODE",50,340

	CALL	TOEXIT
KKLL	IWINFR	10,40,400,220


	LDL	AUDIT_LIST,AR5
LYTL
	FILL	12,42,398,218,COL_LGREY
	LDI	50,R5

	LDI	DEFAULT_COLOR,RC
LLTT	LDI	*AR5++,AR2
	CMPI	-1,AR2
	BEQ	LLRR
	CMPI	-2,AR2
	BEQ	KKLL
	CMPI	-3,AR2
	BEQ	JJTTA


	LDI	AR2,R0
	RS	16,R0
	CMPI	AUD_ROUTINE,R0
	BNE	NOCALL
	LDI	*AR5++,R0
	CALLU	R0
	BU	J22AB

NOCALL	CALL	AUDIT_READ

J22AB	LDI	R0,R2
	LDI	@bufferI,AR2
	CALL	_itoa
J22A

	LDI	R5,R3
	LDI	250,R2
	LDI	DEFAULT_COLOR,RC
	CALL	_outtextxyc

	LDI	*AR5++,AR2
	LDI	R5,R3
	LDI	20,R2
	LDI	DEFAULT_COLOR,RC
	CALL	_outtextxyc
JJTTA	ADDI	10,R5
	BU	LLTT
LLRR


	LDI	0,R0
	STI	R0,@OLDDIP

WL2A
	LDI	@DIPRAM,R0
	LDI	@OLDDIP,R1
	CMPI	R0,R1
	BEQ	NODIPPLOT

	STI	R0,@OLDDIP

	LDI	50,AR2
	LDI	240,R2
	LDI	300,R3
	LDI	249,RC
	LDI	0,RS
	CALL	_fill

;	LDI	@SOFT_AUDIT,R0
;	BZ	KKL7
;
;	CALL	GETCOINTXT
;	LDI	AR0,AR2
;	LDI	DEFAULT_COLOR,RC
;	LDI	50,R2
;	LDI	240,R3
;	LDI	R0,AR0
;	CALL	_outtextxyc
;
;KKL7

NODIPPLOT
	LDI	@_newbut,R0	;old system method


	LDI	@_newbut,R1		;debounce
	TSTB	SW_DIAG,R1		;start to return to main
	BZ	BOOKX

	RS	16,R1
	TSTB	SW_VIEW0_H,R1
	BNZ	NOLOG

	LDI	@SOFT_AUDIT,R0		;OPERATOR MAY NOT VIEW THESE
	BZ	NOLOG
	CALL	ERROR_LOG_DISPLAY
	BU	AUDIT_DISPLAY
NOLOG

	TSTB	SW_VOLPLUS,R0
	BZ	DBNCE
;	BZ	LYTL			;NEXT PAGE
	TSTB	SW_VOLMINUS,R0
	BNZ	FFB2
;	BZ	LYTL			;NEXT PAGE

DBNCE	NOT	@_newbut,R1		;debounce
	AND	SW_VOLPLUS|SW_VOLMINUS,R1
	BNZ	DBNCE
	BU	LYTL

FFB2	TSTB	SW_VIEW2_H,R1		;view2 to display next audit page
	BNZ	KKLL5

RB44	LDI	@_newbut,R1		;debounce
	RS	16,R1
	TSTB	SW_VIEW2_H,R1		;view2 to display next audit page
	BZ	RB44
	BU	LYTL			;NEXT PAGE
KKLL5

	LDI	@SOFT_AUDIT,R0
	BZ	KKL
	TSTB	SW_VIEW1_H,R1		;VIEW1 TO EXIT TO GAME (IN SECRET MODE)
	RETSZ
KKL
	BU	WL2A

BOOKX

WL266
	NOT	@_newbut,R0
	AND	SW_DIAG,R0
	BNZ	WL266
	RETS
*----------------------------------------------------------------------------




